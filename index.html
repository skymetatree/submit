<!doctype html>
<html>

<head>
    <title>SkyMetaTree Submit Data</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- nav bar -->
    <header>
        <div class="nav-bar">
            <nav>
                <ul>
                    <li>
                        <a href="https://github.com/skymetatree">&lt; Back</a> |
                        <a href="https://github.com/skymetatree/submit">GitHub Project</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- form -->
    <div class="user-form">
        <h3>Minecraft Username [optional]</h3>
        <input id="username" type="text" placeholder="Username" /><br>
        <hr>
        <h3>Setup Name</h3>
        <input id="name" type="text" placeholder="Setup Name" /><br>
        <h3>Armor</h3>
        <input id="helmet_reforge" placeholder="Reforge" list="armor_reforge_list" />
        <input id="helmet" placeholder="Helmet" list="helmets_list" />
        <input id="helmet_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="helmet_recombobulated" type="checkbox" /><label for="helmet_recombobulated">Rarity Upgrade</label><br>

        <input id="chestplate_reforge" placeholder="Reforge" list="armor_reforge_list" />
        <input id="chestplate" placeholder="Chestplate" list="chestplates_list" />
        <input id="chestplate_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="chestplate_recombobulated" type="checkbox" /><label for="chestplate_recombobulated">Rarity Upgrade</label><br>

        <input id="leggings_reforge" placeholder="Reforge" list="armor_reforge_list" />
        <input id="leggings" placeholder="Leggings" list="leggings_list" />
        <input id="leggings_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="leggings_recombobulated" type="checkbox" /><label for="leggings_recombobulated">Rarity Upgrade</label><br>

        <input id="boots_reforge" placeholder="Reforge" list="armor_reforge_list" />
        <input id="boots" placeholder="Boots" list="boots_list" />
        <input id="boots_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="boots_recombobulated" type="checkbox" /><label for="boots_recombobulated">Rarity Upgrade</label><br>
        <h3>Pet</h3>
        <input id="pet_rarity" placeholder="Rarity" list="pet_rarity_list" />
        <input id="pet_level" type="number" placeholder="Level" />
        <input id="pet" placeholder="Pet" list="pets_list" /><br>
        <h3>Main Weapon</h3>
        <input id="main_weapon_reforge" placeholder="Reforge" list="weapon_reforge_list" />
        <input id="main_weapon" placeholder="Main Weapon" list="weapons_list" />
        <input id="main_weapon_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="main_weapon_recombobulated" type="checkbox" /><label for="main_weapon_recombobulated">Rarity Upgrade</label><br>
        <h3>Skill Requirements</h3>
        <input id="min_skill1" placeholder="Category" list="min_skills_list" />
        <input id="min_skill1_level" placeholder="Level / Amount" /><br>
        <input id="min_skill2" placeholder="Category" list="min_skills_list" />
        <input id="min_skill2_level" placeholder="Level / Amount" /><br>
        <input id="min_skill3" placeholder="Category" list="min_skills_list" />
        <input id="min_skill3_level" placeholder="Level / Amount" /><br>
        <input id="min_skill4" placeholder="Category" list="min_skills_list" />
        <input id="min_skill4_level" placeholder="Level / Amount" /><br>
        <h3>Ability Items</h3>
        <input id="ability_item1_reforge" placeholder="Reforge" list="weapon_reforge_list" />
        <input id="ability_item1" placeholder="Ability Item" list="ability_items_list" />
        <input id="ability_item1_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="ability_item1_recombobulated" type="checkbox" /><label for="ability_item1_recombobulated">Rarity Upgrade</label><br>
        <input id="ability_item2_reforge" placeholder="Reforge" list="weapon_reforge_list" />
        <input id="ability_item2" placeholder="Ability Item" list="ability_items_list" />
        <input id="ability_item2_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="ability_item2_recombobulated" type="checkbox" /><label for="ability_item2_recombobulated">Rarity Upgrade</label><br>
        <input id="ability_item3_reforge" placeholder="Reforge" list="weapon_reforge_list" />
        <input id="ability_item3" placeholder="Ability Item" list="ability_items_list" />
        <input id="ability_item3_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="ability_item3_recombobulated" type="checkbox" /><label for="ability_item3_recombobulated">Rarity Upgrade</label><br>
        <input id="ability_item4_reforge" placeholder="Reforge" list="weapon_reforge_list" />
        <input id="ability_item4" placeholder="Ability Item" list="ability_items_list" />
        <input id="ability_item4_upgrades" placeholder="Stars / Kills" list="upgrades_list" />
        <input id="ability_item4_recombobulated" type="checkbox" /><label for="ability_item4_recombobulated">Rarity Upgrade</label><br>
        <hr>
        <h3>Hourly Income</h3>
        <input id="income" placeholder="Hourly Income" list="ability_item_list" /><br>
        <h3>Initial Setup Cost</h3>
        <input id="cost" placeholder="Initial Setup Cost" list="ability_item_list" /><br>

        <hr>
        <h3>Notes</h3>
        <textarea id="notes" style="width:75%;height:5em;word-wrap: normal;" placeholder="Anything you want to add?"></textarea><br>

        <hr>
        <h3>Submit Data</h3>
        <button id="submit-button">Send Data to Google Forms</button><br>
        <hr>
    </div>

    <!-- data lists -->
    <datalist id="helmets_list"></datalist>
    <datalist id="chestplates_list"></datalist>
    <datalist id="leggings_list"></datalist>
    <datalist id="boots_list"></datalist>
    <datalist id="pets_list"></datalist>
    <datalist id="pet_rarity_list">
        <option>Common</option>
        <option>Uncommon</option>
        <option>Rare</option>
        <option>Epic</option>
        <option>Legendary</option>
        <option>Mythic</option>
    </datalist>
    <datalist id="weapons_list"></datalist>
    <datalist id="ability_items_list"></datalist>
    <datalist id="min_skills_list">
        <option>Fairy Souls</option>
        <option>Skill Average</option>
        <option>Magical Power</option>
        <option>HotM</option>
        <option>Bank Coins</option>
        <option>Zombie Slayer</option>
        <option>Spider Slayer</option>
        <option>Wolf Slayer</option>
        <option>Enderman Slayer</option>
        <option>Blaze Slayer</option>
        <option>Catacombs</option>
        <option>Healer</option>
        <option>Mage</option>
        <option>Berserk</option>
        <option>Archer</option>
        <option>Tank</option>
        <option>Farming</option>
        <option>Mining</option>
        <option>Combat</option>
        <option>Foraging</option>
        <option>Fishing</option>
        <option>Enchanting</option>
        <option>Alchemy</option>
    </datalist>
    <!-- TODO add armor_reforge_list -->
    <datalist id="armor_reforge_list"></datalist>
    <!-- TODO add weapon_reforge_list -->
    <datalist id="weapon_reforge_list"></datalist>
    <datalist id="upgrades_list">
        <option></option>
        <option>1✪</option>
        <option>2✪</option>
        <option>3✪</option>
        <option>4✪</option>
        <option>5✪</option>
        <option>6✪</option>
        <option>7✪</option>
        <option>8✪</option>
        <option>9✪</option>
        <option>10✪</option>
        <option>11✪</option>
        <option>12✪</option>
        <option>13✪</option>
        <option>14✪</option>
        <option>15✪</option>
    </datalist>

    <!-- script -->
    <script>
        const pet_data = [{
            id: "ARMADILLO",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "BAT",
            rarities: ["common", "uncommon", "rare", "epic", "legendary", "mythic"],
            maxLevel: 100,
        }, {
            id: "BLAZE",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "CHICKEN",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "HORSE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "JERRY",
            rarities: ["common", "uncommon", "rare", "epic", "legendary", "mythic"],
            maxLevel: 100,
        }, {
            id: "OCELOT",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "PIGMAN",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "RABBIT",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SHEEP",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SILVERFISH",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "WITHER_SKELETON",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SKELETON_HORSE",
            rarities: ["legendary"],
            maxLevel: 100,
        }, {
            id: "WOLF",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ENDERMAN",
            rarities: ["common", "uncommon", "rare", "epic", "legendary", "mythic"],
            maxLevel: 100,
        }, {
            id: "PHOENIX",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "MAGMA_CUBE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "FLYING_FISH",
            rarities: ["rare", "epic", "legendary", "mythic"],
            maxLevel: 100,
        }, {
            id: "BLUE_WHALE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "TIGER",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "LION",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "PARROT",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SNOWMAN",
            rarities: ["legendary"],
            maxLevel: 100,
        }, {
            id: "TURTLE",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "BEE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ENDER_DRAGON",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GUARDIAN",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SQUID",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GIRAFFE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ELEPHANT",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "MONKEY",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SPIDER",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ENDERMITE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GHOUL",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "JELLYFISH",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "PIG",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ROCK",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SKELETON",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "ZOMBIE",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "DOLPHIN",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "BABY_YETI",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "MEGALODON",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GOLEM",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "HOUND",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "TARANTULA",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "BLACK_CAT",
            rarities: ["legendary"],
            maxLevel: 100,
        }, {
            id: "SPIRIT",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GRIFFIN",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "MITHRIL_GOLEM",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GRANDMA_WOLF",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "RAT",
            rarities: ["legendary", "mythic"],
            maxLevel: 100,
        }, {
            id: "BAL",
            rarities: ["epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SCATHA",
            rarities: ["rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "GOLDEN_DRAGON",
            rarities: ["legendary"],
            maxLevel: 200,
        }, {
            id: "AMMONITE",
            rarities: ["legendary"],
            maxLevel: 100,
        }, {
            id: "MOOSHROOM_COW",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "SNAIL",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "KUUDRA",
            rarities: ["common", "uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, {
            id: "WISP",
            rarities: ["uncommon", "rare", "epic", "legendary"],
            maxLevel: 100,
        }, ];

        var skyblock_pets = {};
        var skyblock_helmets = [];
        var skyblock_chestplates = [];
        var skyblock_leggings = [];
        var skyblock_boots = [];
        var skyblock_weapons = [];
        var skyblock_ability_items = [];

        const tmp_list = document.getElementById("pets_list");
        pet_data.forEach(function(item) {
            var option = document.createElement("option");
            var pet_name = item.id.replace(/_/, " ").split(" ")
                .map((word) => word[0].toUpperCase() + word.slice(1).toLowerCase())
                .join(" ");
            option.value = pet_name;
            skyblock_pets[pet_name] = {
                rarities: item.rarities,
                maxLevel: item.maxLevel,
            };
            tmp_list.appendChild(option);
        });

        function getItemTier(itemTier) {
            return (itemTier == undefined || itemTier.length < 1) ? "&c" : ("&" + itemTier[0].toLowerCase());
        }

        function addToDatalist(datalistId, optionName) {
            var option = document.createElement("option");
            option.value = optionName;
            document.getElementById(datalistId).appendChild(option);
        }
        async function loadSkyBlockItems() {
            const response = await fetch("https://api.hypixel.net/resources/skyblock/items");
            var skyblockitems = await response.json();
            skyblockitems = skyblockitems.items;

            skyblockitems.forEach(function(item) {
                if (item.category == undefined) {
                    return;
                }
                const name = getItemTier(item.tier) + item.name;
                const category = item.category;
                if (category === "HELMET") {
                    addToDatalist("helmets_list", name);
                    skyblock_helmets.push(item);
                }
                if (category === "CHESTPLATE") {
                    addToDatalist("chestplates_list", name);
                    skyblock_chestplates.push(item);
                }
                if (category === "LEGGINGS") {
                    addToDatalist("leggings_list", name);
                    skyblock_leggings.push(item);
                }
                if (category === "BOOTS") {
                    addToDatalist("boots_list", name);
                    skyblock_boots.push(item);
                }
                if (category === "SWORD" || category === "BOW" || category === "FISHING_WEAPON" || category === "LONGSWORD") {
                    addToDatalist("weapons_list", name);
                    addToDatalist("ability_items_list", name);
                    skyblock_weapons.push(item);
                    skyblock_ability_items.push(item);
                }
                if (category === "WAND" || category === "PICKAXE" || category === "AXE" || category === "HOE" ||
                    category === "FISHING_ROD" || category === "DEPLOYABLE" || category === "DRILL" || category === "SPADE") {
                    addToDatalist("ability_items_list", name);
                    skyblock_ability_items.push(item);
                }
            });
        }
        loadSkyBlockItems();
        const button = document.getElementById("submit-button");
        button.addEventListener("click", function(event) {
            event.preventDefault();

            // TODO build the submitted text

            var result = "\"name\": \"";
            result += "";
            result += "\",\n";
            result += "\"helmet\": \"";
            result += "";
            result += "\",\n";
            result += "\"chestplate\": \"";
            result += "";
            result += "\",\n";
            result += "\"leggings\": \"";
            result += "";
            result += "\",\n";
            result += "\"boots\": \"";
            result += "";
            result += "\",\n";
            result += "\"pet\": \"";
            result += "";
            result += "\",\n";
            result += "\"main_weapon\": \"";
            result += "";
            result += "\",\n";
            result += "\"min_skills\": [\"";
            result += "";
            result += "\"],\n";
            result += "\"ability_items\": [\"";
            result += "";
            result += "\"],\n";
            result += "\"income\": \"";
            result += "";
            result += "\",\n";
            result += "\"cost\": \"";
            result += "";
            result += "\",\n";

            // TODO check if valid. only then continue

            const path = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSfo_YODrIHaz29amZ5XmvMlYEG-SZmbFsSBP9r2UJhgp4Ow5w/formResponse?";
            const params = {
                usp: "pp_url",
                "entry.640704899": document.getElementById("username").value,
                "entry.667247848": result,
                "entry.1992162842": document.getElementById("notes").value,
            };
            button.disabled = true;
            fetch(path + Object.entries(params).map(kv => kv.join("=")).join("&"), {
                mode: "cors"
            }).finally(() => {
                alert("Thank you for your submission!");
                button.disabled = false;
            });
        });
    </script>
</body></html>
